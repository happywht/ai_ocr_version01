# 🎯 GUI预览系统完整功能说明

## 📋 功能概述

票据识别工具现已集成完整的GUI预览系统，支持发票识别和图纸图签提取两种模式，提供实时预览、双击查看、无损处理等全方位功能。

## ✨ 核心新功能

### 1. 📊 增强文件树显示
- **OCR状态列**：实时显示文件处理状态（待处理/处理中/已完成/失败）
- **AI置信度列**：显示AI识别的置信度百分比
- **完整信息**：文件名、大小、状态、OCR状态、AI置信度、完整路径

### 2. 🖱️ 双击图片预览功能
- **操作方式**：双击文件列表中的任何图片或PDF文件
- **预览内容**：
  - 原始图片显示
  - 图纸模式下的图签区域检测
  - 无损处理前后的对比
  - 图片详细信息（尺寸、大小、格式等）

### 3. 👁️ 右侧实时预览面板
- **触发方式**：单击选择文件即可在右侧显示预览
- **显示内容**：
  - 缩略图预览
  - 图签检测可视化（红框标注检测区域）
  - 文件基本信息
  - OCR和AI识别状态

### 4. 🎯 智能图签区域检测
- **自动检测**：针对工程图纸智能识别图签区域
- **可视化显示**：在预览中用红框标注检测到的图签区域
- **无损裁剪**：保持100%精度的图签区域提取

### 5. 🔄 模式切换功能
- **发票识别模式**：优化用于发票信息提取
- **图纸图签提取模式**：专门处理工程图纸图签信息
- **智能适配**：根据模式自动调整处理参数和字段配置

## 🚀 使用方法

### 启动程序
```bash
python 启动GUI_集成版.py
```

### 基本操作流程

#### 1. 添加文件
- 点击"📂 选择文件"选择单个文件
- 点击"📁 选择文件夹"批量添加文件
- 支持的格式：PDF、JPG、PNG、BMP、TIFF

#### 2. 选择识别模式
- **发票识别**：点击"🧾 发票识别"按钮
- **图纸图签**：点击"📐 图纸图签"按钮

#### 3. 预览功能
- **单击文件**：在右侧面板查看实时预览
- **双击文件**：打开详细预览窗口
- **查看图签检测**：图纸模式下自动显示检测区域

#### 4. 批量处理
- 选择文件后点击"🔄 开始批量识别"
- 系统会自动处理所有文件
- 实时更新处理状态和AI置信度

#### 5. 导出结果
- 单个文件：选中后点击"📥 导出选中"
- 批量导出：点击"📋 批量导出Excel"

## 🔧 技术特性

### 无损图片处理
- **精度第一**：100%保持原始图片质量
- **零压缩**：使用无损PNG格式，零信息损失
- **智能模式**：自动选择最佳处理策略

### 图签检测算法
- **位置分析**：基于图签通常在右下角的规律
- **边缘检测**：使用OpenCV Canny算法检测边缘
- **置信度评估**：综合位置、尺寸、密度等因素计算置信度

### AI智能识别
- **高精度提取**：基于智谱GLM模型的智能字段提取
- **动态字段**：支持配置文件定义的任意字段
- **置信度反馈**：实时显示识别结果的可信度

## 📊 界面布局说明

```
┌─────────────────────────────────────────────────────────────┐
│ 顶部工具栏：模式切换、文件操作、批量处理、导出等按钮          │
├─────────────────────────────────────────────────────────────┤
│ 文件列表区域                │ 预览显示区域                   │
│ ┌─────────────────────────┐ │ ┌─────────────────────────────┐ │
│ │ 文件树（增强显示）      │ │ │ 图片/文件预览               │ │
│ │ - OCR状态列            │ │ │ - 缩略图显示                │ │
│ │ - AI置信度列           │ │ │ - 图签检测可视化            │ │
│ │ - 完整路径信息         │ │ │ - 详细信息显示              │ │
│ └─────────────────────────┘ │ └─────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 底部状态栏：处理进度、统计信息、操作提示                      │
└─────────────────────────────────────────────────────────────┘
```

## 💡 使用技巧

### 提高识别精度
1. **使用高质量图片**：推荐300DPI以上的扫描件
2. **确保图片清晰**：避免模糊、倾斜或光线不均的图片
3. **选择正确模式**：发票使用发票模式，图纸使用图纸模式

### 批量处理优化
1. **先预览确认**：使用预览功能确认图片质量
2. **分批处理**：大量文件建议分批处理，避免内存占用过高
3. **监控进度**：注意底部状态栏的处理进度

### 图签检测优化
1. **完整图纸**：使用完整的工程图纸进行检测
2. **标准格式**：标准的工程图纸格式检测效果更好
3. **检查结果**：通过预览确认检测区域是否准确

## 🔍 故障排除

### 常见问题
1. **预览不显示**：检查文件格式是否支持，确保文件路径正确
2. **图签检测失败**：某些非标准图纸可能无法检测，使用原始图片处理
3. **AI识别置信度低**：检查图片质量，尝试重新扫描或使用更高分辨率

### 性能优化
1. **内存管理**：处理大量文件时注意内存使用
2. **存储空间**：无损处理会产生较大的临时文件
3. **网络连接**：AI识别需要网络连接，确保网络稳定

## 📈 系统要求

- **操作系统**：Windows 10/11
- **Python版本**：3.8+
- **内存要求**：8GB+（推荐16GB）
- **存储空间**：至少1GB可用空间
- **网络要求**：AI识别需要互联网连接

## 🎉 完成情况

✅ **已实现功能**：
- [x] 增强文件树显示（OCR状态、AI置信度）
- [x] 双击图片预览功能
- [x] 右侧实时预览面板
- [x] 智能图签区域检测和可视化
- [x] 完全无损图片处理
- [x] 发票/图纸模式切换
- [x] AI智能字段提取
- [x] Excel动态字段导出

🚀 **现在您可以使用完整的GUI预览系统，享受高效的票据和图纸识别体验！**

---

*最后更新：2025-12-16*
*版本：集成版 v2.0*