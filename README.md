# 专用发票OCR识别工具

> 🤖 AI增强版 - 支持图片和PDF的专业发票识别工具

## 🎯 项目简介

这是一个专业的发票OCR识别工具，集成了AI智能识别功能，支持多种文件格式和导出方式，提供命令行和图形界面两种使用方式。

### ✨ 核心特性

- **🖼️ 多格式支持**: 支持图片(.jpg/.png/.bmp/.tiff)和PDF文件
- **🤖 AI智能识别**: 集成智谱AI，高精度字段提取
- **📊 专业导出**: Excel横向列格式，企业级报表标准
- **⚡ 批量处理**: 一键处理大量发票文件
- **🎨 友好界面**: 现代化GUI，操作简单直观
- **🔧 灵活配置**: 支持AI/传统模式切换

## 🚀 快速开始

### 方式一：图形界面 (推荐)
```bash
# 双击运行
run.bat

# 或命令行启动
python start.py
```

### 方式二：命令行
```bash
# 单张发票识别
python start.py cli 发票图片.jpg

# PDF文件识别
python start.py cli 发票文件.pdf

# 导出Excel格式
python start.py cli 发票图片.jpg -f xlsx -o 结果.xlsx

# 批量处理目录中的发票
python start.py cli 发票目录/ --batch
```

## 📁 项目结构

```
票据识别工具/
├── start.py              # 统一启动脚本
├── run.bat               # Windows启动脚本
├── src/                  # 源代码目录
│   ├── invoice_ocr_tool.py     # 核心OCR识别工具
│   ├── ai_invoice_parser.py   # AI智能解析器
│   ├── excel_exporter.py     # Excel导出工具
│   └── invoice_gui.py        # GUI界面
├── examples/              # 示例和测试文件
│   ├── example_usage.py      # 使用示例
│   └── test_invoice.png     # 测试发票图片
├── tests/                  # 测试文件
│   └── test_tool.py          # 测试脚本
├── docs/                   # 文档目录
│   ├── README.md            # 本文档
│   ├── requirements.txt     # 依赖列表
│   └── *.md                # 各功能说明文档
├── output/                 # 输出文件目录
├── backup/                 # 备份文件目录
└── .spec-workflow/          # 项目工作流配置
```

## 🔧 环境要求

### 必需依赖
- Python 3.7+
- umi-OCR服务 (运行在127.0.0.1:1224)

### Python依赖
```
requests>=2.25.0    # HTTP请求库
Pillow>=8.0.0        # 图片处理
pypdfium2>=4.30.0    # PDF处理
anthropic>=0.60.0    # AI智能识别
openpyxl>=3.0.0       # Excel导出
```

### 安装依赖
```bash
pip install -r docs/requirements.txt
```

## 🎯 功能说明

### 支持的文件格式
- **图片**: JPG, JPEG, PNG, BMP, TIFF
- **文档**: PDF (自动转换为图片进行识别)

### 识别字段
1. **发票号码** - 发票的唯一标识
2. **开票日期** - YYYY-MM-DD格式
3. **销售方名称** - 开票方公司名称
4. **购买方名称** - 收票方公司名称
5. **合计金额** - 价税合计金额
6. **税额** - 增值税金额

### 导出格式
- **JSON**: 完整的结构化数据
- **TXT**: 简洁的文本报告
- **CSV**: 表格数据，便于Excel处理
- **Excel**: 专业横向列格式 (推荐)

## 🤖 AI智能识别

### AI功能特性
- **高精度识别**: 基于智谱GLM-4.6模型
- **智能修正**: 自动纠正OCR识别错误
- **置信度评估**: 提供识别结果可信度
- **智能回退**: AI失败时自动使用传统方法

### AI控制
```bash
# 启用AI识别 (默认)
python start.py cli 发票.jpg

# 禁用AI，使用传统方法
python start.py cli 发票.jpg --no-ai

# 自定义AI配置
python start.py cli 发票.jpg --ai-model "glm-4.6"
```

## 📊 Excel导出

### Excel格式特点
- **横向列布局**: 序号/字段名称/提取内容/状态
- **专业样式**: 企业级报表外观
- **状态标识**: 颜色编码显示识别状态
- **批量汇总**: 支持多张发票汇总报表

### Excel输出示例
```
发票识别结果
图片路径: invoice.jpg
解析方式: 🤖 AI智能解析
AI置信度: 100%

字段提取结果
┌─────┬───────────────┬───────────────┬───────────────┐
│序号 │   字段名称    │   提取内容    │     状态     │
├─────┼───────────────┼───────────────┼───────────────┤
│ 1   │发票号码       │12345678      │  ✅ 成功     │
│     │(唯一标识)     │               │               │
├─────┼───────────────┼───────────────┼───────────────┤
│ 2   │开票日期       │2024-01-01     │  ✅ 成功     │
│     │(开具日期)     │               │               │
└─────┴───────────────┴───────────────┴───────────────┘
```

## ⚡ 批量处理

### 批量处理功能
- **多文件类型**: 同时处理图片和PDF文件
- **实时进度**: 显示处理进度和状态
- **结果统计**: 统计成功率和AI识别数量
- **批量导出**: 生成汇总Excel报表

### 批量处理使用
```bash
# GUI方式
1. 启动GUI: `python start.py`
2. 点击"📁 批量处理"按钮
3. 选择包含发票文件的目录
4. 等待处理完成
5. 导出结果

# 命令行方式 (需要实现)
python start.py cli 发票目录/ --batch --output batch_results.xlsx
```

## 🖥️ GUI界面功能

### 界面特点
- **实时状态**: 显示OCR和AI服务连接状态
- **图片预览**: 选择图片后立即预览
- **AI控制**: 一键切换AI/传统识别模式
- **进度显示**: 实时显示处理进度
- **多标签页**: 提取字段/原始OCR/AI分析结果
- **多格式导出**: 支持JSON/TXT/CSV/Excel

### GUI操作流程
1. **启动**: 双击 `run.bat` 或运行 `python start.py`
2. **选择文件**: 点击"📂 选择发票图片"
3. **识别**: 点击"🚀 开始识别"
4. **查看结果**: 在"📊 提取字段"标签页查看
5. **导出**: 点击"💾 导出结果"选择格式

## 📋 命令行参数

```bash
python start.py cli <图片文件> [选项]

选项:
  -f, --format {json,txt,csv,xlsx}  导出格式 (默认: json)
  -o, --output <文件>              输出文件路径
  --host <地址>                     OCR服务主机 (默认: 127.0.0.1)
  --port <端口>                     OCR服务端口 (默认: 1224)
  --debug                           开启调试模式
  --no-ai                           禁用AI智能解析
  --ai-model <模型>                 AI模型名称 (默认: glm-4.6)
  --ai-api-key <密钥>              智谱AI API密钥
  --ai-base-url <URL>              智谱AI基础URL
```

## 🛠️ 开发和测试

### 运行测试
```bash
# GUI测试
python start.py  # 选择3运行测试

# 命令行测试
python examples/example_usage.py
python tests/test_tool.py

# 单元测试
python -m unittest tests/
```

### 项目结构说明
- `src/`: 核心源代码
- `examples/`: 使用示例和测试数据
- `tests/`: 测试脚本
- `docs/`: 项目文档
- `output/`: 输出文件目录
- `backup/`: 备份文件

## 🤝 贡献指南

### 代码规范
- 遵循PEP 8编码规范
- 使用类型注解
- 编写单元测试
- 添加详细的文档注释

### 提交流程
1. Fork 项目
2. 创建功能分支
3. 提交代码
4. 创建Pull Request

## 📄 更新日志

### v2.0.0 (2024-12-02)
- ✅ 新增PDF文件支持
- ✅ 集成智谱AI智能识别
- ✅ 实现Excel专业导出
- ✅ 完善批量处理功能
- ✅ 优化GUI界面体验
- ✅ 添加项目文档

### v1.0.0 (初始版本)
- ✅ 基础OCR识别功能
- ✅ 简单GUI界面
- ✅ JSON/TXT导出

## 📞 技术支持

### 问题反馈
如遇到问题，请提供以下信息：
1. 操作系统和Python版本
2. 错误信息和截图
3. 测试文件(如有)

### 联系方式
- 提交Issue到项目仓库
- 查看项目文档获取更多信息

---

**项目状态**: 🚀 生产就绪
**开发语言**: Python 3.7+
**AI模型**: 智谱GLM-4.6
**最后更新**: 2024-12-02